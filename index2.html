<!DOCTYPE html>
<html>
  <head>
    <title>Image Display</title>
    <style>
      #apiImage {
        width: 500px; /* desired width */
        height: auto; /* maintain aspect ratio */
      }
    </style>
  </head>
  <body>
    <h1>Image from API</h1>
    <img id="apiImage" src="" alt="Image will be displayed here" />

    <!-- Input for file selection -->
    <input type="file" id="fileInput" accept=".jpg, .jpeg" />
    <button id="uploadButton">Upload Image</button>

    <script>
      fetch(
        "https://c9fuffy6cg.execute-api.eu-north-1.amazonaws.com/prod/recipe-bucket-anna?ID=test_put6.jpg",
        {
          method: "GET",
        }
      )
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json(); // Changed from response.json() to response.text()
        })
        .then((data) => {
          // Use the base64 string from the response
          const imageElement = document.getElementById("apiImage");
          imageElement.src = "data:image/jpeg;base64," + data.image; // Assuming 'image' is the key in the JSON response
        })
        .catch((error) => console.error("Error fetching image:", error));

      //   // UPLOADING IMAGE FUNCTION
      //   function uploadImage(file, recipeID) {
      //     // Here you can convert the file to base64 if needed or send as FormData
      //     const formData = new FormData();
      //     formData.append("image", file);

      //     fetch(
      //       `https://c9fuffy6cg.execute-api.eu-north-1.amazonaws.com/prod/recipe-bucket-anna?ID=${recipeID}.jpg`,
      //       {
      //         method: "POST",
      //         body: formData, // Send the file in FormData
      //       }
      //     )
      //       .then((response) => response.text())
      //       .then((data) => {
      //         console.log("Image upload successful:", data);
      //       })
      //       .catch((error) => console.error("Error uploading image:", error));
      //   }

      function uploadImage(file, recipeID) {
        const reader = new FileReader();
        reader.onload = function (event) {
          const binaryData = event.target.result;

          fetch(
            `https://c9fuffy6cg.execute-api.eu-north-1.amazonaws.com/prod/recipe-bucket-anna?ID=${encodeURIComponent(
              recipeID
            )}.jpg`,
            {
              method: "POST",
              body: binaryData, // Send the binary data directly
            }
          )
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.text();
            })
            .then((data) => {
              console.log("Image upload successful:", data);
            })
            .catch((error) => console.error("Error uploading image:", error));
        };
        reader.readAsArrayBuffer(file); // Read the file as an ArrayBuffer
      }

      // Event listener for the upload button
      document
        .getElementById("uploadButton")
        .addEventListener("click", function () {
          const fileInput = document.getElementById("fileInput");
          if (fileInput.files.length > 0) {
            const file = fileInput.files[0];
            uploadImage(file, "test_put6"); // Call the function to upload the image
          } else {
            alert("Please select an image file to upload.");
          }
        });
    </script>
  </body>
</html>
